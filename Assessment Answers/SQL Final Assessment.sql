create database LMS_DB;
use LMS_DB;
create table LMS_MEMBERS(
	MEMBER_ID VARCHAR(10) references LMS_BOOK_ISSUE(MEMBER_ID),
    MEMBER_NAME VARCHAR(30),
    CITY VARCHAR(20),
    DATE_REGISTER DATE,
    DATE_EXPIRE DATE,
    MEMBERSHIP_STATUS VARCHAR(15)
);

CREATE TABLE LMS_BOOK_ISSUE(
	BOOK_ISSUE_NO INT,
    MEMBER_ID VARCHAR(10),
    BOOK_CODE VARCHAR(10),
    DATE_ISSUE DATE,
    DATE_RETURN DATE,
    DATE_RETURNED DATE,
    BOOK_ISSUE_STATUS VARCHAR(20),
    FINE_RANGE VARCHAR(3)
);

CREATE TABLE LMS_BOOK_DETAILS(
	BOOK_CODE VARCHAR(10) references LMS_BOOK_ISSUE(BOOK_CODE),
    BOOK_TITLE VARCHAR(50),
    CATEGORY VARCHAR(15),
    AUTHOR VARCHAR(30),
    PUBLICATION VARCHAR(30),
    PUBLISH_DATE DATE,
    BOOK_EDITION INT,
    PRICE INT,
    RACK_NUM VARCHAR(3),
    DATE_ARRIVAL DATE,
    SUPPLIER_ID VARCHAR(3)
);

CREATE TABLE LMS_FINE_DETAILS(
	FINE_RANGE VARCHAR(3) references LMS_BOOK_ISSUE(FINE_RANGE),
    FINE_AMOUNT INT
);

CREATE TABLE LMS_SUPPLIERS_DETAILS(
	SUPPLIER_ID VARCHAR(3) references LMS_BOOK_DETAILS(SUPPLIER_ID),
    SUPPLIER_NAME VARCHAR(30),
    ADDRESS VARCHAR(50),
    CONTACT INT,
    EMAIL VARCHAR(15)
);

INSERT INTO LMS_MEMBERS VALUES
("LM001","AMIT","CHENNAI","2012-02-12","2013-02-11","Temporary"),
("LM002","ABDUL","DELHI","2012-04-10","2013-04-09","Temporary"),
("LM003","GAYAN","CHENNAI","2012-05-13","2013-05-12","Permanent"),
("LM004","RADHA","CHENNAI","2012-04-22","2013-04-21","Temporary"),
("LM005","GURU","BANGALORE","2012-03-30","2013-05-16","Temporary"),
("LM006","MOHAN","CHENNAI","2012-04-12","2013-05-16","Temporary");

INSERT INTO LMS_FINE_DETAILS VALUES
("R0",0),("R1",20),("R2",50),("R3",75),("R4",100),("R5",150),("R6",200);

INSERT INTO LMS_SUPPLIERS_DETAILS VALUES
("S01","SINGAPORE SHOPPEE","CHENNAI",98941235,"sing@gmail.com"),
("S02","JK Stores","MUMBAI",99401234,"jks@yahoo.com"),
("S03","ROSE BOOK STORE","TRIVANDRUM",94444112,"rose@gmail.com"),
("S04","KAVARI STORE","DELHI",86300014,"kavi@redif.com"),
("S05","EINSTEN BOOK GALLERY","US",95420000,"eingal@aol.com"),
("S06","AKBAR STORE","MUMBAI",78556231,"akbakst@aol.com");
DELETE FROM LMS_BOOK_ISSUE;
INSERT INTO LMS_BOOK_DETAILS VALUES
("BL000010","Java ForvDummies","JAVA","Paul J. Deital","Prenitce Hall","1999-12-10",6,575,"A1","2011-05-10","S01"),
("BL000002","Java The Complete R","JAVA","Tata Mcgrar Hill","Prenitce Hall","2011-10-10",5,750,"A1","2011-05-10","S03"),
("BL000003","Java How To Do Program","JAVA","Prentice Hall","Prenitce Hall","1999-05-10",6,600,"A1","2012-05-10","S01"),
("BL000004","Java The Complete R","JAVA","Tata Mcgrar Hill","Prenitce Hall","2011-10-10",5,750,"A1","2012-05-11","S01"),
("BL000005","Java How To Do Program","JAVA","Prentice Hall","Prenitce Hall","1999-12-10",6,600,"A1","2012-05-11","S01"),
("BL000006","Java The Complete R","JAVA","Tata Mcgrar Hill","Prenitce Hall","2011-10-10",5,750,"A1","2011-05-12","S03"),
("BL000007","Let Us C","C","Paul J. Deital","BPB Publications","2010-12-11",9,500,"A3","2010-11-03","S03"),
("BL000008","Let Us C","C","Paul J. Deital","BPB Publications","2010-05-12",9,500,"A3","2011-08-09","S04"),
("BL000009","Let Us C#","C","Paul J. Deital","BPB Publications","2010-05-12",9,550,"A3","2011-08-09","S04"),
("BL000011","Let Us C++","C","Paul J. Deital","BPB Publications","2010-05-12",9,650,"A3","2011-08-09","S04");

INSERT INTO LMS_BOOK_ISSUE VALUES
(1,"LM001","BL000010","2012-05-01","2012-05-16","2012-05-16","null","R0"),
(2,"LM002","BL000002","2012-05-01","2012-05-06","2012-05-16","null","R2"),
(3,"LM003","BL000007","2012-04-01","2012-04-16","2012-04-20","null","R1"),
(4,"LM004","BL000005","2012-04-01","2012-04-16","2012-04-20","null","R1"),
(5,"LM005","BL000008","2012-03-30","2012-04-15","2012-04-20","null","R1"),
(6,"LM005","BL000008","2012-04-20","2012-05-05","2012-05-05","null","R0"),
(7,"LM003","BL000007","2012-04-22","2012-05-07","2012-05-25","null","R4");

-- Q1)
DESC LMS_BOOK_DETAILS;
-- Q2)
SELECT * FROM LMS_FINE_DETAILS;
-- Q3)
SELECT MEMBER_NAME FROM LMS_MEMBERS WHERE CITY="CHENNAI";
-- Q4)
SELECT MEMBER_ID,MEMBER_NAME,CITY,MEMBERSHIP_STATUS FROM LMS_MEMBERS WHERE MEMBERSHIP_STATUS="Permanent";
-- Q5)
SELECT MEMBER_ID,MEMBER_NAME FROM LMS_MEMBERS
WHERE MEMBER_ID=(SELECT MEMBER_ID FROM LMS_BOOK_ISSUE WHERE BOOK_CODE="BL000002");
-- Q6)
SELECT BOOK_CODE,BOOK_TITLE,AUTHOR FROM LMS_BOOK_DETAILS
WHERE AUTHOR LIKE "P%";
-- Q7)
START transaction;
SELECT COUNT(*) AS "NO_OF_BOOKS" FROM LMS_BOOK_DETAILS WHERE CATEGORY="Java";
COMMIT;
-- Q8)
SELECT COUNT(CATEGORY) AS NO_OF_BOOKS,CATEGORY FROM LMS_BOOK_DETAILS
GROUP BY CATEGORY;
-- Q9)
SELECT COUNT(*) AS "NO_OF_BOOKS" FROM LMS_BOOK_DETAILS WHERE PUBLICATION="Prenitce Hall";
-- 10)
SELECT LMS_BOOK_DETAILS.BOOK_CODE,LMS_BOOK_DETAILS.BOOK_TITLE from LMS_BOOK_DETAILS 
INNER JOIN LMS_BOOK_ISSUE on LMS_BOOK_DETAILS.BOOK_CODE=LMS_BOOK_ISSUE.BOOK_CODE WHERE LMS_BOOK_ISSUE.DATE_ISSUE="2012-04-01";
-- Q11)
SELECT MEMBER_ID,MEMBER_NAME,DATE_REGISTER,DATE_EXPIRE FROM LMS_MEMBERS WHERE DATE_EXPIRE NOT IN('2013-04-09','2013-04-21');
-- Q12)
SELECT MEMBER_ID, MEMBER_NAME,DATE_REGISTER, MEMBERSHIP_STATUS FROM LMS_MEMBERS WHERE DATE_REGISTER < '2012-03-01' && MEMBERSHIP_STATUS = 'Temporary';
-- Q13)
SELECT MEMBER_ID, MEMBER_NAME FROM LMS_MEMBERS WHERE CITY = 'CHENNAI' || 'DELHI';
-- Q14)
SELECT CONCAT(BOOK_TITLE, "IS WRITTEN BY ",AUTHOR) AS DETAILS FROM LMS_BOOK_DETAILS;
-- Q15)
START transaction;
SELECT AVG(PRICE) FROM LMS_BOOK_DETAILS WHERE CATEGORY="JAVA";
COMMIT;
-- Q16)
SELECT SUPPLIER_ID,SUPPLIER_NAME,EMAIL FROM LMS_SUPPLIERS_DETAILS WHERE EMAIL LIKE "%@gmail.com";
-- Q17)
SELECT SUPPLIER_ID,SUPPLIER_NAME,COALESCE(CONTACT,EMAIL,ADDRESS)AS "CONTACT DETAILS" FROM LMS_SUPPLIERS_DETAILS ;

-- Q20)
SELECT BOOK_CODE,BOOK_TITLE,RACK_NUM FROM LMS_BOOK_DETAILS WHERE RACK_NUM="A1" ORDER BY BOOK_TITLE ASC;
-- Q23)
SELECT RACK_NUM,COUNT(RACK_NUM) AS "NO_OF_BOOKS" FROM LMS_BOOK_DETAILS GROUP BY RACK_NUM;
-- Q26)
SELECT * FROM LMS_SUPPLIERS_DETAILS LIMIT 3;
-- Q27)
SELECT * FROM LMS_SUPPLIERS_DETAILS ORDER BY SUPPLIER_ID LIMIT 5 OFFSET 3;
-- Q28)
ALTER TABLE LMS_MEMBERS RENAME TO LAMS_MEMBERS_DETAILS;
-- Q29)
TRUNCATE TABLE LMS_FINE_DETAILS;
-- Q30)
SELECT ALL BOOK_TITLE FROM LMS_BOOK_DETAILS;


-- Q15 WITH FUNCTION

Delimiter $
CREATE FUNCTION AVERAGE()
RETURNS int
deterministic
BEGIN
SELECT AVG(PRICE) FROM LMS_BOOK_DETAILS WHERE CATEGORY="JAVA";
END $
call average();

Delimiter $
CREATE FUNCTION UPDATECITYY(CITY VARCHAR(10))
RETURNS VARCHAR(10)
DETERMINISTIC
BEGIN
SELECT * FROM LMS_SUPPLIERS_DETAILS;
RETURN 1;
END $
Delimiter ;

CALL UPDATECITYY("KOLKATA");
SELECT * FROM LMS_SUPPLIERS_DETAILS;

